# 基础概念梳理

## 全文检索
全文检索是计算机程序通过扫描文章中的每一个词，对必要的词建立一个索引，指明该词在文章中出现的次数和位置。当用户查询时根据建立的索引查找，类似于通过字典的检索字表查字的过程。
全面、准确和快速是衡量全文检索系统的关键指标。

关于全文检索，我们要知道：
• 只处理文本。
• 不处理语义。
• 搜索时英文不区分大小写。
• 结果列表有相关度排序。
• 并且可以对结果具有过滤高亮的功能

##  倒排索引
要实现上述相关度排序，就离不开倒排索引机制。
是实现了单词——文档矩阵的一种具体存储形式。通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。
倒排索引主要由两部分组成：
• 单词词典
• 倒排文件


##  Elasticsearch定义
Elasticsearch是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。
Elasticsearch也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。
主要特点如下：
• 简单的restful api，天生的兼容多语言开发。
• 分布式的实时文件存储，每个字段都被索引且可用于搜索。
• 分布式的实时分析搜索引擎，海量数据下近实时秒级响应。
• 易扩展，处理PB级结构化或非结构化数据。

## Lucene与ES关系？
• Lucene只是一个库。想要使用它，你必须使用Java来作为开发语言并将其直接集成到你的应用中，更糟糕的是，Lucene非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。
• Elasticsearch也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。

## Elasticsearch主要解决问题
• 检索相关数据
• 返回统计结果
• 速度要快


## Elastic stack 主要指什么？
Elastic Stack数据平台由Logstash、Beats、ElasticSearch和Kibana四大核心产品组成，在数据摄取、存储计算分析及数据可视化方面有着无可比拟的优势。
Logstash和Beats作为底层核心引擎组成数据摄取平台，可以将数据进行标准化，便于后续分析使用。
Beats作为轻量级的数据搬运工，集合了多种单一用途数据采集器，将数据发送给Logstash或ElasticSearch，其可扩展的框架及丰富的预置采集器将使工作事半功倍。
Logstash 是开源的服务器端数据处理管道，可同时从多个来源采集、转换数据，并将数据发送到存储库中。在存储、计算和分析方面，ElasticSearch允许执行和合并多种类型的搜索，解决不断涌现的各种用例，并具有极高的可用性及容错性，充分保障集群安全。
Kibana作为用户界面的核心，集成了丰富的可视化工具、界面交互开发工具和管理工具，帮助开发人员将数据轻松分享给任何人，甚至还能通过机器学习来监测数据中的隐藏异常并追溯其来源。
以这四大核心产品为基础构建的Elastic数据平台实现了数据实时性、相关性及扩展性的完美结合，不仅可以处理各种数据，还能深入挖掘数据的内在关联并迅速呈现，彻底解决企业的大数据实时处理难题。
注意：
（1）beats、logstash 都不考。本系列课程中不会涉及，但的确作为优秀的开源软件，Elastic stack套件建议大家都主动去学习！
（2）kibana 会考试中会部分涉猎，用户、角色、权限部分。


## Cluster：集群
Elasticsearch可以作为一个独立的单个搜索服务器（单节点）。
不过，为了处理大型数据集，实现容错和高可用性，Elasticsearch可以运行在许多互相合作的服务器上。这些服务器的集合称为集群。
认证考试中，会涉及到多个集群。

## Node：节点
形成集群的每个服务器称为节点。
认证考试中有单个节点的集群，也有多个节点的集群。
举例：我考试中，最大规模的集群中有4个节点。

##  Shard：分片
当有大量的文档时，由于内存的限制、磁盘处理能力不足、无法足够快的响应客户端的请求等，一个节点可能不够。这种情况下，数据可以分为较小的分片。每个分片放到不同的服务器上。
当你查询的索引分布在多个分片上时，ES会把查询发送给每个相关的分片，并将结果组合在一起，而应用程序并不知道分片的存在。即：这个过程对用户来说是透明的。

## Replia：副本
为提高查询吞吐量或实现高可用性，可以使用分片副本。
副本是一个分片的精确复制，每个分片可以有零个或多个副本。ES中可以有许多相同的分片，其中之一被选择更改索引操作，这种特殊的分片称为主分片。
当主分片丢失时，如：该分片所在的数据不可用时，集群将副本提升为新的主分片。
注意：Elasticsearch7.X之后，默认主分片数为1，副本分片数为1。

## 对标mysql 加深概念理解

![atzg8P.png](https://s1.ax1x.com/2020/08/03/atzg8P.png)


## Elasticsearch优势和特点

• 分布式实时文件存储，可将每一个字段存入索引，使其可以被检索到。
• 实时分析的分布式搜索引擎。分布式：索引分拆成多个分片，每个分片可有零个或多个副本。集群中的每个数据节点都可承载一个或多个分片，并且协调和处理各种操作； 负载再平衡和路由在大多数情况下自动完成。
• 可以扩展到上百台服务器，处理PB级别的结构化或非结构化数据。也可以运行在单台PC上（已测试）
• 支持插件机制，分词插件、同步插件、Hadoop插件、可视化插件等。

# 集群环境准备

Elasticsearch 双节点或多节点集群环境部署

详情可见docker-compose

```cmd
environment:
      - cluster.name=cluster1 #集群名称，唯一确定一个集群。
      - node.name=cluster1_es7_01 #节点名称，一个集群中的节点名称是唯一固定的，不同节点不能同名。
      - node.master=true #主节点属性值
      - node.data=true #数据节点属性值
      - node.ingest=true
      - http.port=9200 #本节点的http端口
      - transport.port=9300 #集群之间通信的端口，若不指定默认：9300
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - discovery.seed_hosts=cluster1_es7_01,cluster1_es7_02 #节点发现需要配置一些种子节点，与7.X之前老版本：disvoery.zen.ping.unicast.hosts类似，一般配置集群中的全部节点
      - cluster.initial_master_nodes=cluster1_es7_01,cluster1_es7_02 #指定集群初次选举中用到的具有主节点资格的节点，称为集群引导，只在第一次形成集群时需要
```

